<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>AI Writer - AssignSavvy</title>
  <link rel="icon" type="image/svg+xml" href="./assets/favicon.svg" />
  <link rel="stylesheet" href="./styles/main.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
  <style>
    :root {
      --gradient-primary: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      --gradient-secondary: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
      --gradient-accent: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
      --spacing-xs: 0.5rem;
      --spacing-sm: 1rem;
      --spacing-md: 1.5rem;
      --spacing-lg: 2rem;
      --spacing-xl: 3rem;
    }

    body {
      background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
    }

    .writer-container {
      display: flex;
      flex-direction: column;
      flex: 1;
      min-height: calc(100vh - 80px);
      max-height: calc(100vh - 80px);
      padding: var(--spacing-sm);
      max-width: 100%;
      overflow: hidden;
    }
     
    .chat-section {
      display: flex;
      flex-direction: column;
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(20px);
      border-radius: 20px;
      border: 1px solid rgba(255, 255, 255, 0.2);
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
      overflow: hidden;
      flex: 1;
      min-height: 0;
    }
     
    .content-panel {
      flex: 1;
      display: flex;
      flex-direction: column;
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(20px);
      border-radius: 20px;
      border: 1px solid rgba(255, 255, 255, 0.2);
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
      overflow: hidden;
    }
    

    
    .history-meta {
      font-size: 0.75rem;
      color: var(--text-secondary);
      margin: 0;
    }
    
    .history-actions {
      margin-top: var(--spacing-sm);
      display: flex;
      justify-content: flex-end;
    }
    
    .modal-large {
      max-width: 900px;
      width: 90vw;
    }
    
    .history-filters {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: var(--spacing-lg);
      gap: var(--spacing-md);
    }
    
    .filter-group {
      display: flex;
      gap: var(--spacing-sm);
    }
    
    .filter-btn {
      padding: var(--spacing-sm) var(--spacing-md);
      border: 1px solid rgba(226, 232, 240, 0.8);
      background: rgba(255, 255, 255, 0.9);
      border-radius: 8px;
      font-size: 0.875rem;
      font-weight: 500;
      color: var(--text-secondary);
      cursor: pointer;
      transition: all 0.3s ease;
    }
    
    .filter-btn:hover {
      background: rgba(102, 126, 234, 0.1);
      border-color: rgba(102, 126, 234, 0.3);
      color: var(--text-primary);
    }
    
    .filter-btn.active {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      border-color: transparent;
      color: white;
      box-shadow: 0 2px 8px rgba(102, 126, 234, 0.3);
    }
    
    .search-group {
      flex: 1;
      max-width: 300px;
    }
    
    .history-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: var(--spacing-md);
      max-height: 500px;
      overflow-y: auto;
    }
    
    .history-card {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(20px);
      border: 1px solid rgba(226, 232, 240, 0.8);
      border-radius: 12px;
      padding: var(--spacing-md);
      transition: all 0.3s ease;
      cursor: pointer;
    }
    
    .history-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
      border-color: rgba(102, 126, 234, 0.3);
    }
    
    .history-card-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: var(--spacing-sm);
    }
    
    .history-card-header h4 {
      font-size: 1rem;
      font-weight: 600;
      color: var(--text-primary);
      margin: 0;
      line-height: 1.3;
      flex: 1;
    }
    
    .history-type {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: var(--spacing-xs) var(--spacing-sm);
      border-radius: 6px;
      font-size: 0.75rem;
      font-weight: 500;
      text-transform: capitalize;
    }
    
    .history-preview {
      font-size: 0.875rem;
      color: var(--text-secondary);
      line-height: 1.5;
      margin: 0 0 var(--spacing-sm) 0;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }
    
    .history-card .history-meta {
      display: flex;
      gap: var(--spacing-md);
      font-size: 0.75rem;
      color: var(--text-secondary);
      margin-bottom: var(--spacing-sm);
    }
    
    .history-card .history-meta span {
      display: flex;
      align-items: center;
      gap: var(--spacing-xs);
    }
    
    .history-card-actions {
      display: flex;
      gap: var(--spacing-sm);
    }
    
    .chat-messages {
      flex: 1;
      padding: var(--spacing-lg);
      overflow-y: auto;
      background: transparent;
      display: flex;
      flex-direction: column;
      gap: var(--spacing-md);
    }
    
    .message {
      display: flex;
      align-items: flex-start;
      animation: messageSlideIn 0.3s ease-out;
    }
    
    @keyframes messageSlideIn {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    
    .message.user {
      flex-direction: row-reverse;
    }
    
    .message-avatar {
      width: 45px;
      height: 45px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 0 var(--spacing-sm);
      font-size: 1.3rem;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    }
    
    .message.user .message-avatar {
      background: var(--gradient-accent);
      color: white;
    }
    
    .message.assistant .message-avatar {
      background: var(--gradient-secondary);
      color: white;
    }
    
    .message-content {
      max-width: 70%;
      padding: var(--spacing-md) var(--spacing-lg);
      border-radius: 20px;
      line-height: 1.6;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      position: relative;
    }
    
    .message.user .message-content {
      background: var(--gradient-accent);
      color: white;
    }
    
    .message.assistant .message-content {
      background: rgba(255, 255, 255, 0.9);
      color: #2c3e50;
      border: 1px solid rgba(255, 255, 255, 0.3);
    }
    
    .message-time {
      font-size: 0.75rem;
      color: #95a5a6;
      margin-top: 4px;
    }
    
    .chat-input-container {
      padding: var(--spacing-lg);
      background: transparent;
      border-top: 1px solid rgba(255, 255, 255, 0.1);
    }
    
    .chat-input-wrapper {
      display: flex;
      align-items: flex-end;
      background: rgba(255, 255, 255, 0.9);
      border: 2px solid rgba(255, 255, 255, 0.3);
      border-radius: 25px;
      padding: var(--spacing-xs);
      transition: all 0.3s ease;
      backdrop-filter: blur(10px);
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
      position: relative;
    }
    
    .chat-input-wrapper:focus-within {
      border-color: rgba(102, 126, 234, 0.5);
      box-shadow: 0 8px 25px rgba(102, 126, 234, 0.2);
    }
    
    .file-upload-btn {
      background: none;
      border: none;
      color: #6c757d;
      font-size: 1.2rem;
      padding: var(--spacing-xs) var(--spacing-sm);
      cursor: pointer;
      border-radius: 50%;
      transition: all 0.3s ease;
    }
    
    .file-upload-btn:hover {
      background: rgba(102, 126, 234, 0.1);
      color: #667eea;
      transform: scale(1.1);
    }
    
    .chat-input {
      flex: 1;
      border: none;
      background: none;
      padding: var(--spacing-sm) var(--spacing-md);
      font-size: 1rem;
      resize: none;
      outline: none;
      max-height: 120px;
      min-height: 20px;
      font-family: inherit;
    }
    
    .send-btn {
      background: var(--gradient-primary);
      border: none;
      color: white;
      padding: var(--spacing-sm);
      border-radius: 50%;
      cursor: pointer;
      font-size: 1rem;
      transition: all 0.3s ease;
      box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
    }
    
    .send-btn:hover:not(:disabled) {
      transform: scale(1.05);
      box-shadow: 0 6px 16px rgba(102, 126, 234, 0.4);
    }
    
    .send-btn:disabled {
      background: #bdc3c7;
      cursor: not-allowed;
      transform: none;
      box-shadow: none;
    }
    
    /* Canvas-style content message */
    .content-canvas {
      background: rgba(248, 250, 252, 0.95);
      border: 1px solid rgba(226, 232, 240, 0.8);
      border-radius: 16px;
      margin: var(--spacing-md) 0;
      overflow: hidden;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
      backdrop-filter: blur(10px);
    }
    
    .canvas-header {
      background: rgba(255, 255, 255, 0.9);
      border-bottom: 1px solid rgba(226, 232, 240, 0.5);
      padding: var(--spacing-md);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .canvas-title {
      font-weight: 600;
      color: #2c3e50;
      font-size: 1rem;
      margin: 0;
      display: flex;
      align-items: center;
      gap: var(--spacing-sm);
    }
    
    .canvas-actions {
      display: flex;
      gap: var(--spacing-xs);
    }
    
    .canvas-btn {
      background: rgba(255, 255, 255, 0.9);
      border: 1px solid rgba(226, 232, 240, 0.8);
      border-radius: 8px;
      padding: var(--spacing-xs) var(--spacing-sm);
      cursor: pointer;
      color: #64748b;
      transition: all 0.2s ease;
      font-size: 0.875rem;
      display: flex;
      align-items: center;
      gap: 4px;
    }
    
    .canvas-btn:hover {
      background: rgba(102, 126, 234, 0.1);
      border-color: rgba(102, 126, 234, 0.3);
      color: #667eea;
    }
    
    .canvas-content {
      padding: var(--spacing-lg);
      background: white;
      font-family: 'Georgia', serif;
      line-height: 1.7;
      color: #2c3e50;
      max-height: 600px;
      overflow-y: auto;
    }
    
    .canvas-content.editing {
      background: rgba(255, 255, 255, 0.95);
      border: 2px solid rgba(102, 126, 234, 0.3);
      outline: none;
      resize: vertical;
    }
    
    .canvas-stats {
      background: rgba(248, 250, 252, 0.8);
      border-top: 1px solid rgba(226, 232, 240, 0.5);
      padding: var(--spacing-sm) var(--spacing-lg);
      display: flex;
      justify-content: space-between;
      font-size: 0.8rem;
      color: #64748b;
    }
    
    /* Notification animations */
    @keyframes slideIn {
      from {
        transform: translateX(100%);
        opacity: 0;
      }
      to {
        transform: translateX(0);
        opacity: 1;
      }
    }
    
    @keyframes slideOut {
      from {
        transform: translateX(0);
        opacity: 1;
      }
      to {
        transform: translateX(100%);
        opacity: 0;
      }
    }
    
    .panel-header {
      padding: var(--spacing-lg);
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      background: rgba(255, 255, 255, 0.05);
      backdrop-filter: blur(10px);
    }
    
    .panel-header h3 {
      margin: 0;
      color: #2c3e50;
      font-size: 1.3rem;
      font-weight: 600;
    }
    
    .panel-content {
      flex: 1;
      padding: var(--spacing-lg);
      overflow-y: auto;
      display: flex;
      flex-direction: column;
    }
    
    .editor-toolbar {
      display: flex;
      gap: var(--spacing-sm);
      margin-bottom: var(--spacing-md);
      padding-bottom: var(--spacing-md);
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }
    
    .toolbar-btn {
      background: rgba(255, 255, 255, 0.9);
      border: 1px solid rgba(255, 255, 255, 0.3);
      padding: var(--spacing-xs) var(--spacing-sm);
      border-radius: 8px;
      cursor: pointer;
      color: #495057;
      transition: all 0.3s ease;
      backdrop-filter: blur(10px);
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }
    
    .toolbar-btn:hover {
      background: rgba(102, 126, 234, 0.1);
      border-color: rgba(102, 126, 234, 0.3);
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(102, 126, 234, 0.2);
    }
    
    .content-editor {
      width: 100%;
      height: 400px;
      border: 1px solid rgba(255, 255, 255, 0.3);
      border-radius: 12px;
      padding: var(--spacing-lg);
      font-family: 'Georgia', serif;
      font-size: 1rem;
      line-height: 1.6;
      resize: vertical;
      outline: none;
      background: rgba(255, 255, 255, 0.9);
      backdrop-filter: blur(10px);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      transition: all 0.3s ease;
    }
    
    .content-editor:focus {
      border-color: rgba(102, 126, 234, 0.5);
      box-shadow: 0 4px 16px rgba(102, 126, 234, 0.2);
    }
    
    .content-stats {
      display: flex;
      justify-content: space-between;
      margin-top: var(--spacing-md);
      padding-top: var(--spacing-md);
      border-top: 1px solid rgba(255, 255, 255, 0.1);
      font-size: 0.85rem;
      color: #6c757d;
    }
    
    .uploaded-files {
      margin-top: var(--spacing-md);
    }
    
    .file-item {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: var(--spacing-xs) var(--spacing-sm);
      background: rgba(255, 255, 255, 0.9);
      border: 1px solid rgba(255, 255, 255, 0.3);
      border-radius: 8px;
      margin-bottom: var(--spacing-xs);
      backdrop-filter: blur(10px);
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      transition: all 0.3s ease;
    }
    
    .file-item:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    }
    
    .file-info {
      display: flex;
      align-items: center;
    }
    
    .file-info i {
      margin-right: var(--spacing-xs);
      color: #6c757d;
    }
    
    .file-remove {
      background: none;
      border: none;
      color: #dc3545;
      cursor: pointer;
      padding: var(--spacing-xs);
      border-radius: 6px;
      transition: all 0.3s ease;
    }
    
    .file-remove:hover {
      background: rgba(220, 53, 69, 0.1);
      transform: scale(1.1);
    }
    
    .typing-indicator {
      display: none;
      align-items: center;
      margin-bottom: var(--spacing-lg);
    }
    
    .typing-indicator.show {
      display: flex;
    }
    
    .typing-indicator .message-avatar {
      background: var(--gradient-secondary);
      color: white;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    }
    
    .typing-dots {
      background: rgba(255, 255, 255, 0.9);
      padding: var(--spacing-sm) var(--spacing-md);
      border-radius: 18px;
      display: flex;
      gap: var(--spacing-xs);
      backdrop-filter: blur(10px);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      border: 1px solid rgba(255, 255, 255, 0.3);
    }
    
    .typing-dot {
      width: 10px;
      height: 10px;
      background: linear-gradient(45deg, #667eea, #764ba2);
      border-radius: 50%;
      animation: typing 1.4s infinite ease-in-out;
    }
    
    .typing-dot:nth-child(2) {
      animation-delay: 0.2s;
    }
    
    .typing-dot:nth-child(3) {
      animation-delay: 0.4s;
    }
    
    @keyframes typing {
      0%, 60%, 100% {
        transform: translateY(0) scale(0.8);
        opacity: 0.5;
      }
      30% {
        transform: translateY(-10px) scale(1.2);
        opacity: 1;
      }
    }
    
    .welcome-message {
      text-align: center;
      padding: var(--spacing-xl) var(--spacing-lg);
      color: #6c757d;
    }
    
    .welcome-message h3 {
      margin-bottom: var(--spacing-sm);
      color: #2c3e50;
      font-weight: 600;
    }
    
    .welcome-message p {
      margin-bottom: var(--spacing-lg);
      line-height: 1.6;
    }
    
    .quick-prompts {
      display: flex;
      flex-wrap: wrap;
      gap: var(--spacing-sm);
      justify-content: center;
    }
    
    .quick-prompt {
      background: rgba(255, 255, 255, 0.9);
      border: 1px solid rgba(255, 255, 255, 0.3);
      padding: var(--spacing-xs) var(--spacing-md);
      border-radius: 20px;
      cursor: pointer;
      font-size: 0.9rem;
      transition: all 0.3s ease;
      backdrop-filter: blur(10px);
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      color: #495057;
    }
    
    .quick-prompt:hover {
      background: var(--gradient-primary);
      color: white;
      border-color: transparent;
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
    }
    
    .quality-options {
      display: flex;
      gap: var(--spacing-sm);
      margin-bottom: var(--spacing-md);
    }
    
    .quality-option {
      flex: 1;
      padding: var(--spacing-sm);
      border: 2px solid rgba(255, 255, 255, 0.3);
      border-radius: 12px;
      text-align: center;
      cursor: pointer;
      transition: all 0.3s ease;
      background: rgba(255, 255, 255, 0.9);
      backdrop-filter: blur(10px);
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }
    
    .quality-option.active {
      border-color: rgba(102, 126, 234, 0.5);
      background: rgba(102, 126, 234, 0.1);
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(102, 126, 234, 0.2);
    }
    
    .quality-option h4 {
      margin: 0 0 var(--spacing-xs) 0;
      color: #2c3e50;
      font-size: 1rem;
      font-weight: 600;
    }
    
    .quality-option p {
      margin: 0;
      font-size: 0.8rem;
      color: #6c757d;
    }
    
    .quality-option:hover {
      border-color: #3498db !important;
      background: #f8f9fa;
    }
    
    .quality-option input[type="radio"]:checked + div {
      color: #3498db;
    }
    
    .quality-option:has(input[type="radio"]:checked) {
      border-color: #3498db !important;
      background: #e3f2fd;
    }
    
    /* Large Desktop Layout */
    @media (min-width: 1400px) {
      .writer-container {
        max-width: 1400px;
        margin: 0 auto;
        gap: var(--spacing-xl);
        padding: var(--spacing-xl);
      }
      
      .chat-section {
        min-height: 500px;
      }
      
      .content-panel {
        min-height: 500px;
      }
    }
    
    /* Tablet Layout */
    @media (max-width: 1200px) {
      .writer-container {
        padding: var(--spacing-lg);
      }
      
      .chat-section {
        min-height: 400px;
      }
      
      .canvas-content {
        max-height: 450px;
      }
    }
    
    /* Mobile Layout */
    @media (max-width: 768px) {
      .dashboard-layout {
        display: flex;
        flex-direction: column;
      }
      
      .dashboard-topbar {
        padding: 0 var(--spacing-md);
        height: 60px;
        position: sticky;
        top: 0;
        z-index: 100;
      }
      
      .topbar-left {
        gap: var(--spacing-sm);
      }
      
      .dashboard-sidebar {
        position: fixed;
        top: 60px;
        left: 0;
        width: 280px;
        height: calc(100vh - 60px);
        transform: translateX(-100%);
        z-index: 999;
        background: rgba(255, 255, 255, 0.98);
        backdrop-filter: blur(20px);
        border-right: 1px solid rgba(226, 232, 240, 0.8);
        transition: transform 0.3s ease;
        overflow-y: auto;
      }
      
      .dashboard-sidebar.sidebar-open {
        transform: translateX(0);
      }
      
      .dashboard-content {
        padding: 0;
        height: calc(100vh - 60px);
        overflow-y: auto;
        width: 100%;
        box-sizing: border-box;
      }
      
      .writer-container {
        padding: var(--spacing-sm);
        margin: 0;
        max-width: 100%;
        min-height: calc(100vh - 60px);
        max-height: calc(100vh - 60px);
      }
      
      .chat-section {
        flex: 1;
        min-height: 0;
        width: 100%;
        box-sizing: border-box;
      }
      
      .canvas-content {
        max-height: 350px;
        font-size: 0.95rem;
      }
      
      .canvas-btn {
        font-size: 0.8rem;
        padding: 6px 8px;
      }
      
      .chat-messages {
        padding: var(--spacing-md);
        height: calc(100% - 120px);
        overflow-y: auto;
      }
      
      .message-content {
        max-width: 85%;
        padding: var(--spacing-md);
        font-size: 0.95rem;
      }
      
      .chat-input-container {
        padding: var(--spacing-md);
      }
      
      .chat-input-wrapper {
        border-radius: 20px;
        padding: var(--spacing-xs);
      }
      
      .chat-input {
        font-size: 1rem;
        padding: var(--spacing-sm) var(--spacing-md);
      }
      
      .panel-header {
        padding: var(--spacing-md);
      }
      
      .panel-header h3 {
        font-size: 1.2rem;
      }
      
      .panel-content {
        padding: var(--spacing-md);
        height: auto;
        overflow: visible;
      }
      
      .content-editor {
        flex: 1;
        min-height: 200px;
        font-size: 1rem;
        padding: var(--spacing-md);
        resize: none;
        overflow-y: auto;
      }
      
      .panel-content {
        flex: 1;
        padding: var(--spacing-md);
        overflow: hidden;
        display: flex;
        flex-direction: column;
      }
      
      .editor-toolbar {
        flex-wrap: wrap;
        gap: var(--spacing-xs);
      }
      
      .toolbar-btn {
        font-size: 0.85rem;
        padding: var(--spacing-xs) var(--spacing-sm);
        min-height: 36px;
      }
      
      .content-stats {
        flex-direction: column;
        gap: var(--spacing-xs);
        text-align: center;
      }
      
      .history-filters {
        flex-direction: column;
        align-items: stretch;
        gap: var(--spacing-sm);
      }
      
      .filter-group {
        justify-content: center;
        flex-wrap: wrap;
      }
      
      .history-grid {
        grid-template-columns: 1fr;
        gap: var(--spacing-sm);
      }
      
      .quality-options {
        flex-direction: column;
        gap: var(--spacing-xs);
      }
      
      .quick-prompts {
        gap: var(--spacing-xs);
        flex-wrap: wrap;
      }
      
      .quick-prompt {
        font-size: 0.9rem;
        padding: var(--spacing-sm) var(--spacing-md);
        min-height: 40px;
        flex: 1;
        min-width: 120px;
      }
    }
    
    /* Small Mobile Layout */
    @media (max-width: 480px) {
      .dashboard-topbar {
        padding: 0 var(--spacing-sm);
        height: 56px;
      }
      
      .dashboard-sidebar {
        width: 100vw;
        top: 56px;
        height: calc(100vh - 56px);
      }
      
      .dashboard-content {
        height: calc(100vh - 56px);
      }
      
      .writer-container {
        padding: var(--spacing-sm);
        min-height: calc(100vh - 56px);
        max-height: calc(100vh - 56px);
      }
      
      .chat-section {
        flex: 1;
        min-height: 0;
      }
      
      .canvas-content {
        max-height: 280px;
        font-size: 0.9rem;
        padding: var(--spacing-md);
      }
      
      .canvas-btn {
        font-size: 0.75rem;
        padding: 4px 6px;
      }
      
      .canvas-header {
        padding: var(--spacing-sm) var(--spacing-md);
      }
      
      .canvas-title {
        font-size: 0.9rem;
      }
      
      .message-avatar {
        width: 36px;
        height: 36px;
        font-size: 1.1rem;
        margin: 0 var(--spacing-xs);
      }
      
      .message-content {
        max-width: 90%;
        padding: var(--spacing-sm) var(--spacing-md);
        font-size: 0.9rem;
        line-height: 1.4;
      }
      
      .chat-messages {
        padding: var(--spacing-sm);
        gap: var(--spacing-sm);
      }
      
      .chat-input-container {
        padding: var(--spacing-sm);
      }
      
      .chat-input {
        font-size: 0.95rem;
        padding: var(--spacing-sm);
      }
      
      .panel-header {
        padding: var(--spacing-sm) var(--spacing-md);
      }
      
      .panel-header h3 {
        font-size: 1.1rem;
      }
      
      .panel-content {
        padding: var(--spacing-sm);
      }
      
      .content-editor {
        flex: 1;
        min-height: 150px;
        resize: none;
        overflow-y: auto;
        font-size: 0.95rem;
        padding: var(--spacing-sm);
      }
      
      .editor-toolbar {
        gap: 4px;
        margin-bottom: var(--spacing-sm);
      }
      
      .toolbar-btn {
        font-size: 0.8rem;
        padding: 6px 8px;
        min-height: 32px;
      }
      
      .content-stats {
        font-size: 0.85rem;
        gap: 4px;
      }
      
      .quick-prompt {
        font-size: 0.85rem;
        padding: var(--spacing-xs) var(--spacing-sm);
        min-height: 36px;
        min-width: 100px;
      }
      
      .filter-btn {
        font-size: 0.8rem;
        padding: var(--spacing-xs) var(--spacing-sm);
      }
      
      .history-card {
        padding: var(--spacing-sm);
      }
      
      .file-upload-btn, .send-btn {
         padding: var(--spacing-xs);
         font-size: 1rem;
       }
    }
      
      .content-actions .btn {
        min-height: 48px;
        font-size: 1rem;
      }
    }
  </style>
</head>
<body>
  <div class="dashboard-layout">
    <!-- Top Bar -->
    <div class="dashboard-topbar">
      <div class="topbar-left">
        <button class="sidebar-toggle" id="sidebar-toggle">
          <i class="fas fa-bars"></i>
        </button>
        <div class="topbar-logo">
          📚 AssignSavvy
        </div>
      </div>
      <div class="topbar-title">Writer</div>
      <div class="topbar-actions">
        <button class="notification-btn" id="notification-btn">
          <i class="fas fa-bell"></i>
          <div class="notification-badge"></div>
        </button>
        <a href="index.html" class="home-btn">
          <i class="fas fa-home"></i>
          <span>Home</span>
        </a>
      </div>
    </div>
    
    <!-- Sidebar -->
    <div class="dashboard-sidebar" id="dashboard-sidebar">
      <!-- Navigation -->
      <ul class="sidebar-nav">
        <li>
          <a href="dashboard.html" class="sidebar-nav-item">
            <i class="fas fa-chart-line"></i>
            <span>Dashboard</span>
          </a>
        </li>
        <li>
          <a href="writer.html" class="sidebar-nav-item active">
            <i class="fas fa-pen"></i>
            <span>Writer</span>
          </a>
        </li>
        <li>
          <a href="researcher.html" class="sidebar-nav-item">
            <i class="fas fa-magnifying-glass"></i>
            <span>Researcher</span>
          </a>
        </li>
        <li>
          <a href="detector.html" class="sidebar-nav-item">
            <i class="fas fa-shield-halved"></i>
            <span>Originality Detector</span>
          </a>
        </li>
        <li>
          <a href="prompt-engineer.html" class="sidebar-nav-item">
            <i class="fas fa-code"></i>
            <span>Prompt Engineer</span>
          </a>
        </li>
        <li>
          <a href="history.html" class="sidebar-nav-item">
            <i class="fas fa-clock-rotate-left"></i>
            <span>History</span>
          </a>
        </li>
      </ul>
      
      <!-- User Account Info - Bottom Corner -->
      <div class="user-account-info">
        <div class="user-profile-card" id="user-profile-card" style="cursor: pointer;">
          <div class="user-avatar">
            <i class="fas fa-user-circle"></i>
          </div>
          <div class="user-details">
            <h4 id="user-name">User Name</h4>
            <p class="user-plan" id="user-plan">Free Plan</p>
            <div class="user-credits">
              <i class="fas fa-coins"></i>
              <span id="user-credits">145/200 Credits</span>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Main Content Area -->
    <div class="dashboard-content">
      <!-- Compact Header Section -->
      <div class="section-header" style="display: flex; align-items: center; padding: 0.5rem 1rem; margin-bottom: 0.5rem;">
        <button class="btn btn-outline" id="open-history-btn" onclick="openHistoryModal()" style="padding: 0.5rem; border-radius: 8px; background: rgba(255, 255, 255, 0.9); border: 1px solid rgba(255, 255, 255, 0.3); backdrop-filter: blur(10px);" title="History">
          <i class="fas fa-history"></i>
        </button>
      </div>
      
      <div class="writer-container">
        
        <!-- Chat Section -->
        <div class="chat-section">
          <div class="chat-messages" id="chat-messages">
            <div class="welcome-message">
               <p>Welcome to AI Writer!</p>
               <p>I'm here to help you create amazing content. What would you like to write today?</p>
              </div>
            
            <!-- Typing indicator -->
            <div class="typing-indicator" id="typing-indicator">
              <div class="message-avatar">
                <i class="fas fa-robot"></i>
              </div>
              <div class="typing-dots">
                <div class="typing-dot"></div>
                <div class="typing-dot"></div>
                <div class="typing-dot"></div>
              </div>
            </div>
          </div>
          
          <div class="chat-input-container">
            <div class="uploaded-files" id="uploaded-files"></div>
            
            <div class="chat-input-wrapper">
              <button class="file-upload-btn" onclick="document.getElementById('file-input').click()" title="Upload files">
                <i class="fas fa-plus"></i>
              </button>
              <textarea 
                id="chat-input" 
                class="chat-input" 
                placeholder="Type your writing request here... (e.g., 'Write a blog post about sustainable living')"
                rows="1"
              ></textarea>
              <!-- Quality Tier Selection -->
              <div class="quality-tier-selection" style="display: flex; align-items: center; gap: 8px; margin: 0 8px;">
                <button class="quality-filter-btn" onclick="toggleQualityOptions()" title="Generation Quality" style="padding: var(--spacing-sm); border: 1px solid rgba(255, 255, 255, 0.3); background: rgba(255, 255, 255, 0.9); border-radius: 50%; cursor: pointer; backdrop-filter: blur(10px); font-size: 1rem; transition: all 0.3s ease; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);">
                  <i class="fas fa-filter"></i>
                </button>
                <div class="quality-options-dropdown" id="quality-options" style="display: none; position: absolute; bottom: 100%; right: 0; background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(20px); border: 1px solid rgba(255, 255, 255, 0.3); border-radius: 12px; padding: 12px; box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15); z-index: 1000; min-width: 320px;">
                  <!-- Content Type Selection -->
                  <div style="font-size: 0.85rem; color: #6c757d; margin-bottom: 8px; font-weight: 500;">
                    <i class="fas fa-file-alt"></i> Content Type:
                  </div>
                  <div style="display: flex; flex-direction: column; gap: 6px; margin-bottom: 12px;">
                    <label class="content-type-option" style="display: flex; align-items: center; cursor: pointer; padding: 6px 10px; border: 2px solid #e9ecef; border-radius: 6px; transition: all 0.3s ease;">
                      <input type="radio" name="contentType" value="general" checked="checked" style="margin-right: 8px;" onchange="toggleAssignmentOptions()" />
                      <div>
                        <div style="font-weight: 500; color: #2c3e50; font-size: 0.85rem;">General Content</div>
                        <div style="font-size: 0.7rem; color: #6c757d;">Essays, articles, blog posts</div>
                      </div>
                    </label>
                    <label class="content-type-option" style="display: flex; align-items: center; cursor: pointer; padding: 6px 10px; border: 2px solid #e9ecef; border-radius: 6px; transition: all 0.3s ease;">
                      <input type="radio" name="contentType" value="assignment" style="margin-right: 8px;" onchange="toggleAssignmentOptions()" />
                      <div>
                        <div style="font-weight: 500; color: #2c3e50; font-size: 0.85rem;">Academic Assignment</div>
                        <div style="font-size: 0.7rem; color: #6c757d;">Structured academic papers with citations</div>
                      </div>
                    </label>
                  </div>
                  
                  <!-- Assignment Options (hidden by default) -->
                  <div id="assignment-options" style="display: none; margin-bottom: 12px; padding: 8px; background: rgba(102, 126, 234, 0.05); border-radius: 8px;">
                    <div style="font-size: 0.8rem; color: #6c757d; margin-bottom: 6px; font-weight: 500;">
                      <i class="fas fa-graduation-cap"></i> Assignment Details:
                    </div>
                    <input type="text" id="assignment-title" placeholder="Assignment title (required)" style="width: 100%; padding: 6px 8px; border: 1px solid #ddd; border-radius: 4px; font-size: 0.8rem; margin-bottom: 6px; box-sizing: border-box;" />
                    <select id="citation-style" style="width: 100%; padding: 6px 8px; border: 1px solid #ddd; border-radius: 4px; font-size: 0.8rem; box-sizing: border-box;">
                      <option value="APA">APA Citation Style</option>
                      <option value="MLA">MLA Citation Style</option>
                      <option value="Chicago">Chicago Citation Style</option>
                    </select>
                  </div>
                  
                  <!-- Quality Selection -->
                  <div style="font-size: 0.85rem; color: #6c757d; margin-bottom: 8px; font-weight: 500;">
                    <i class="fas fa-star"></i> Generation Quality:
                  </div>
                  <div style="display: flex; flex-direction: column; gap: 8px;">
                    <label class="quality-option" style="display: flex; align-items: center; cursor: pointer; padding: 8px 12px; border: 2px solid #e9ecef; border-radius: 8px; transition: all 0.3s ease;">
                      <input type="radio" name="qualityTier" value="standard" checked="checked" style="margin-right: 8px;" />
                      <div>
                        <div style="font-weight: 500; color: #2c3e50; font-size: 0.9rem;">Standard</div>
                        <div style="font-size: 0.75rem; color: #6c757d;">1 credit per 3 words • Fast generation</div>
                      </div>
                    </label>
                    <label class="quality-option" style="display: flex; align-items: center; cursor: pointer; padding: 8px 12px; border: 2px solid #e9ecef; border-radius: 8px; transition: all 0.3s ease;">
                      <input type="radio" name="qualityTier" value="premium" style="margin-right: 8px;" />
                      <div>
                        <div style="font-weight: 500; color: #2c3e50; font-size: 0.9rem;">Premium</div>
                        <div style="font-size: 0.75rem; color: #6c757d;">2 credits per 3 words • Enhanced quality</div>
                      </div>
                    </label>
                  </div>
                </div>
              </div>
              <button class="send-btn" id="send-btn" onclick="sendMessage()" disabled="disabled">
                <i class="fas fa-paper-plane"></i>
              </button>
            </div>
            <input type="file" id="file-input" multiple="multiple" accept=".pdf,.docx,.txt" style="display: none;" />
          </div>
        </div>
        
        <!-- Content will appear as canvas messages in the chat -->
      </div>
    </div>

  </div>
  
  <!-- History Modal -->
  <div id="history-modal" class="modal" style="display: none;">
    <div class="modal-content modal-large">
      <div class="modal-header">
        <h3><i class="fas fa-history"></i> Project History</h3>
        <button id="close-history-modal" class="btn-close">×</button>
      </div>
      <div class="modal-body">
        <div class="history-filters">
          <div class="filter-group">
            <button class="filter-btn active" data-filter="all">All</button>
            <button class="filter-btn" data-filter="essay">Essays</button>
            <button class="filter-btn" data-filter="research">Research</button>
            <button class="filter-btn" data-filter="report">Reports</button>
          </div>
          <div class="search-group">
            <input type="text" class="form-input" placeholder="Search projects..." id="history-search" />
          </div>
        </div>
        
        <div class="history-grid" id="history-grid">
          <!-- History items will be loaded here -->
        </div>
      </div>
    </div>
  </div>
  
  <!-- User Profile Modal -->
  <div id="user-profile-modal" class="modal" style="display: none;">
    <div class="modal-content">
      <div class="modal-header">
        <h3>User Profile</h3>
        <button id="close-profile-modal" class="btn-close">×</button>
      </div>
      <div class="modal-body">
        <div class="profile-section">
          <div class="profile-avatar">
            <i class="fas fa-user-circle text-6xl text-primary"></i>
          </div>
          <div class="profile-info">
            <h4 id="modal-user-name">User Name</h4>
            <p class="text-gray" id="modal-user-email">john.doe@example.com</p>
            <div class="plan-info">
              <span class="plan-badge" id="modal-user-plan">Free Plan</span>
              <div class="credits-info">
                <i class="fas fa-coins text-orange"></i>
                <span id="modal-user-credits">145/200 Credits</span>
              </div>
            </div>
          </div>
        </div>
        <div class="profile-actions">
          <button class="btn btn-outline" onclick="window.location.href='auth.html'">Account Settings</button>
          <button class="btn btn-primary" onclick="window.location.href='pricing.html'">Upgrade Plan</button>
          <button class="btn btn-outline" onclick="logout()">Logout</button>
        </div>
      </div>
    </div>
  </div>
  
  <!-- User Session Manager -->
  <script src="js/userSession.js"></script>
  
  <script>
    // Load user profile data
    function loadUserProfile() {
      // Now handled by UserSessionManager
      window.userSession.updateAllDisplays();
    }

    // Get current user data
    function getCurrentUser() {
      return window.userSession.getCurrentUser();
    }

    let uploadedFiles = [];
    let messageHistory = [];
    
    // Initialize
    document.addEventListener('DOMContentLoaded', function() {
      // Load user profile data
      loadUserProfile();
      
      // User profile modal functionality
      const userProfileCard = document.getElementById('user-profile-card');
      const userProfileModal = document.getElementById('user-profile-modal');
      const closeProfileModal = document.getElementById('close-profile-modal');
      
      userProfileCard.addEventListener('click', function() {
        userProfileModal.style.display = 'flex';
      });
      
      closeProfileModal.addEventListener('click', function() {
        userProfileModal.style.display = 'none';
      });
      
      window.addEventListener('click', function(event) {
        if (event.target === userProfileModal) {
          userProfileModal.style.display = 'none';
        }
      });
      
      // History modal functionality
      const historyModal = document.getElementById('history-modal');
      const closeHistoryModal = document.getElementById('close-history-modal');
      
      if (closeHistoryModal) {
        closeHistoryModal.addEventListener('click', function() {
          historyModal.style.display = 'none';
        });
      }
      
      window.addEventListener('click', function(event) {
        if (event.target === historyModal) {
          historyModal.style.display = 'none';
        }
      });
      
      // History filter functionality
      document.addEventListener('click', function(event) {
        if (event.target.classList.contains('filter-btn')) {
          document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
          event.target.classList.add('active');
          
          const filter = event.target.dataset.filter;
          const historyCards = document.querySelectorAll('.history-card');
          
          historyCards.forEach(card => {
            if (filter === 'all' || card.dataset.type === filter) {
              card.style.display = 'block';
            } else {
              card.style.display = 'none';
            }
          });
        }
      });
      
      // History search functionality
      const historySearch = document.getElementById('history-search');
      if (historySearch) {
        historySearch.addEventListener('input', function() {
          const searchTerm = this.value.toLowerCase();
          const historyCards = document.querySelectorAll('.history-card');
          
          historyCards.forEach(card => {
            const title = card.querySelector('h4').textContent.toLowerCase();
            const preview = card.querySelector('.history-preview').textContent.toLowerCase();
            
            if (title.includes(searchTerm) || preview.includes(searchTerm)) {
              card.style.display = 'block';
            } else {
              card.style.display = 'none';
            }
          });
        });
      }
      const chatInput = document.getElementById('chat-input');
      const sendBtn = document.getElementById('send-btn');
      const fileInput = document.getElementById('file-input');
      const sidebarToggle = document.getElementById('sidebar-toggle');
      
      // Sidebar toggle functionality
      const sidebar = document.getElementById('dashboard-sidebar');
      const dashboardLayout = document.querySelector('.dashboard-layout');
      
      sidebarToggle.addEventListener('click', function() {
        if (window.innerWidth <= 768) {
          // Mobile behavior
          sidebar.classList.toggle('sidebar-open');
          dashboardLayout.classList.toggle('sidebar-active');
        } else {
          // Desktop behavior
          dashboardLayout.classList.toggle('sidebar-collapsed');
        }
      });
      
      // Close sidebar when clicking outside on mobile
      document.addEventListener('click', function(event) {
        if (window.innerWidth <= 768) {
          if (!sidebar.contains(event.target) && !sidebarToggle.contains(event.target) && sidebar.classList.contains('sidebar-open')) {
            sidebar.classList.remove('sidebar-open');
            dashboardLayout.classList.remove('sidebar-active');
          }
        }
      });
      
      // Handle window resize
      window.addEventListener('resize', function() {
        if (window.innerWidth > 768) {
          sidebar.classList.remove('sidebar-open');
          dashboardLayout.classList.remove('sidebar-active');
        } else {
          dashboardLayout.classList.remove('sidebar-collapsed');
        }
      });
      
      // Auto-resize chat input
      chatInput.addEventListener('input', function() {
        this.style.height = 'auto';
        this.style.height = Math.min(this.scrollHeight, 120) + 'px';
        
        // Enable/disable send button
        sendBtn.disabled = !this.value.trim();
      });
      
      // Send message on Enter (Shift+Enter for new line)
      chatInput.addEventListener('keydown', function(e) {
        if (e.key === 'Enter' && !e.shiftKey) {
          e.preventDefault();
          if (!sendBtn.disabled) {
            sendMessage();
          }
        }
      });
      
      // File upload handling
      fileInput.addEventListener('change', handleFileUpload);
    });
    
    function useQuickPrompt(prompt) {
      document.getElementById('chat-input').value = prompt;
      document.getElementById('send-btn').disabled = false;
      document.getElementById('chat-input').focus();
    }
    
    function sendMessage() {
      const chatInput = document.getElementById('chat-input');
      const message = chatInput.value.trim();
      
      if (!message) return;
      
      // Add user message
      addMessage('user', message);
      
      // Clear input
      chatInput.value = '';
      chatInput.style.height = 'auto';
      document.getElementById('send-btn').disabled = true;
      
      // Show typing indicator
      showTypingIndicator();
      
      // Simulate AI response
      setTimeout(() => {
        hideTypingIndicator();
        generateContent(message);
      }, 2000);
    }
    
    function addMessage(sender, content, timestamp = new Date()) {
      const messagesContainer = document.getElementById('chat-messages');
      const welcomeMessage = messagesContainer.querySelector('.welcome-message');
      
      if (welcomeMessage) {
        welcomeMessage.style.display = 'none';
      }
      
      const messageDiv = document.createElement('div');
      messageDiv.className = `message ${sender}`;
      
      const avatar = document.createElement('div');
      avatar.className = 'message-avatar';
      avatar.innerHTML = sender === 'user' ? '<i class="fas fa-user"></i>' : '<i class="fas fa-robot"></i>';
      
      const messageContent = document.createElement('div');
      messageContent.className = 'message-content';
      messageContent.innerHTML = content;
      
      const messageTime = document.createElement('div');
      messageTime.className = 'message-time';
      messageTime.textContent = timestamp.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
      
      messageDiv.appendChild(avatar);
      const contentWrapper = document.createElement('div');
      contentWrapper.appendChild(messageContent);
      contentWrapper.appendChild(messageTime);
      messageDiv.appendChild(contentWrapper);
      
      messagesContainer.appendChild(messageDiv);
      messagesContainer.scrollTop = messagesContainer.scrollHeight;
      
      messageHistory.push({sender, content, timestamp});
    }
    
    function addCanvasMessage(sender, title, content, timestamp = new Date()) {
      const messagesContainer = document.getElementById('chat-messages');
      const welcomeMessage = messagesContainer.querySelector('.welcome-message');
      
      if (welcomeMessage) {
        welcomeMessage.style.display = 'none';
      }
      
      const canvasId = 'canvas-' + Date.now();
      
      const messageDiv = document.createElement('div');
      messageDiv.className = `message ${sender}`;
      
      const avatar = document.createElement('div');
      avatar.className = 'message-avatar';
      avatar.innerHTML = '<i class="fas fa-robot"></i>';
      
      const canvasContainer = document.createElement('div');
      canvasContainer.className = 'content-canvas';
      canvasContainer.id = canvasId;
      
      const canvasHeader = document.createElement('div');
      canvasHeader.className = 'canvas-header';
      
      const canvasTitle = document.createElement('h4');
      canvasTitle.className = 'canvas-title';
      canvasTitle.innerHTML = `<i class="fas fa-file-alt"></i> ${title}`;
      
      const canvasActions = document.createElement('div');
      canvasActions.className = 'canvas-actions';
      canvasActions.innerHTML = `
        <button class="canvas-btn" onclick="previewCanvas('${canvasId}')" title="Preview">
          <i class="fas fa-eye"></i> Preview
        </button>
        <button class="canvas-btn" onclick="editCanvas('${canvasId}')" title="Edit">
          <i class="fas fa-edit"></i> Edit
        </button>
        <button class="canvas-btn" onclick="copyCanvas('${canvasId}')" title="Copy">
          <i class="fas fa-copy"></i> Copy
        </button>
        <button class="canvas-btn" onclick="addCitations('${canvasId}')" title="Citations">
          <i class="fas fa-quote-right"></i> Citations
        </button>
        <button class="canvas-btn" onclick="downloadCanvas('${canvasId}')" title="Download">
          <i class="fas fa-download"></i> Download
        </button>
      `;
      
      canvasHeader.appendChild(canvasTitle);
      canvasHeader.appendChild(canvasActions);
      
      const canvasContent = document.createElement('div');
      canvasContent.className = 'canvas-content';
      canvasContent.innerHTML = formatContent(content);
      
      const canvasStats = document.createElement('div');
      canvasStats.className = 'canvas-stats';
      const wordCount = content.trim() ? content.trim().split(/\s+/).length : 0;
      const charCount = content.length;
      canvasStats.innerHTML = `
        <span>${wordCount} words</span>
        <span>${charCount} characters</span>
        <span>${timestamp.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}</span>
      `;
      
      canvasContainer.appendChild(canvasHeader);
      canvasContainer.appendChild(canvasContent);
      canvasContainer.appendChild(canvasStats);
      
      const contentWrapper = document.createElement('div');
      contentWrapper.appendChild(canvasContainer);
      
      messageDiv.appendChild(avatar);
      messageDiv.appendChild(contentWrapper);
      
      messagesContainer.appendChild(messageDiv);
      messagesContainer.scrollTop = messagesContainer.scrollHeight;
      
      messageHistory.push({sender, content: title, timestamp, canvasContent: content});
    }
    
    function formatContent(content) {
      // Convert markdown-like formatting to HTML
      return content
        .replace(/^# (.*$)/gm, '<h1>$1</h1>')
        .replace(/^## (.*$)/gm, '<h2>$1</h2>')
        .replace(/^### (.*$)/gm, '<h3>$1</h3>')
        .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
        .replace(/\*(.*?)\*/g, '<em>$1</em>')
        .replace(/^• (.*$)/gm, '<li>$1</li>')
        .replace(/(<li>.*<\/li>)/s, '<ul>$1</ul>')
        .replace(/\n\n/g, '</p><p>')
        .replace(/^(?!<[h|u|l])/gm, '<p>')
        .replace(/(?<!>)$/gm, '</p>')
        .replace(/<p><\/p>/g, '')
        .replace(/<p>(<[h|u])/g, '$1')
        .replace(/(<\/[h|u].*>)<\/p>/g, '$1');
    }
    
    function showTypingIndicator() {
      document.getElementById('typing-indicator').style.display = 'flex';
      const messagesContainer = document.getElementById('chat-messages');
      messagesContainer.scrollTop = messagesContainer.scrollHeight;
    }
    
    function hideTypingIndicator() {
      document.getElementById('typing-indicator').style.display = 'none';
    }
    
    function toggleAssignmentOptions() {
      const assignmentRadio = document.querySelector('input[name="contentType"][value="assignment"]');
      const assignmentOptions = document.getElementById('assignment-options');
      
      if (assignmentRadio && assignmentOptions) {
        if (assignmentRadio.checked) {
          assignmentOptions.style.display = 'block';
        } else {
          assignmentOptions.style.display = 'none';
        }
      }
    }
    
    async function generateContent(prompt) {
      try {
        // Get selected quality tier and content type
        const qualityTier = document.querySelector('input[name="qualityTier"]:checked').value;
        const contentType = document.querySelector('input[name="contentType"]:checked').value;
        
        // Prepare request body
        const requestBody = {
          prompt: prompt,
          files: uploadedFiles,
          style: 'conversational',
          qualityTier: qualityTier,
          contentType: contentType
        };
        
        // Add assignment-specific parameters if needed
        if (contentType === 'assignment') {
          const assignmentTitle = document.getElementById('assignment-title').value;
          const citationStyle = document.getElementById('citation-style').value;
          
          if (!assignmentTitle.trim()) {
            alert('Please enter an assignment title for academic assignments.');
            return;
          }
          
          requestBody.assignmentTitle = assignmentTitle;
          requestBody.citationStyle = citationStyle;
        }
        
        // Get authentication token
        const authToken = localStorage.getItem('authToken');
        if (!authToken) {
          alert('Please log in to use the writer tool.');
          window.location.href = 'auth.html';
          return;
        }
        
        // Make API call with authentication
        const response = await fetch('/api/writer/generate', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${authToken}`
          },
          body: JSON.stringify(requestBody)
        });
        
        if (!response.ok) {
          throw new Error('Failed to generate content');
        }
        
        const data = await response.json();
        
        // Add AI response with canvas content
        addCanvasMessage('assistant', 'Generated Content', data.content);
        
      } catch (error) {
        console.error('Error generating content:', error);
        
        // Fallback demo content
        const demoContent = generateDemoContent(prompt);
        addCanvasMessage('assistant', 'Generated Content', demoContent);
      }
    }
    
    function generateDemoContent(prompt) {
      // Fallback content when backend is not available
      return `# Content Generation Unavailable\n\nBased on your request: "${prompt}"\n\nThe AI content generation service is currently unavailable. This could be due to:\n\n• Backend server not running\n• Network connectivity issues\n• Service maintenance\n\nPlease ensure the backend server is running and try again. Contact support if the issue persists.\n\n## Next Steps\n\n• Check server status\n• Verify network connection\n• Try again in a few moments\n• Contact technical support if needed`;
    }
    
    function handleFileUpload(event) {
      const files = Array.from(event.target.files);
      const uploadedFilesContainer = document.getElementById('uploaded-files');
      
      files.forEach(file => {
        if (file.size > 10 * 1024 * 1024) { // 10MB limit
          alert(`File ${file.name} is too large. Maximum size is 10MB.`);
          return;
        }
        
        uploadedFiles.push(file);
        
        const fileItem = document.createElement('div');
        fileItem.className = 'file-item';
        fileItem.innerHTML = `
          <div class="file-info">
            <i class="fas fa-file"></i>
            <span>${file.name}</span>
          </div>
          <button class="file-remove" onclick="removeFile('${file.name}')">
            <i class="fas fa-times"></i>
          </button>
        `;
        
        uploadedFilesContainer.appendChild(fileItem);
      });
      
      // Clear file input
      event.target.value = '';
    }
    
    function removeFile(fileName) {
      uploadedFiles = uploadedFiles.filter(file => file.name !== fileName);
      
      const uploadedFilesContainer = document.getElementById('uploaded-files');
      const fileItems = uploadedFilesContainer.querySelectorAll('.file-item');
      
      fileItems.forEach(item => {
        if (item.querySelector('span').textContent === fileName) {
          item.remove();
        }
      });
    }
    
    function updateContentStats() {
      const content = document.getElementById('content-editor').value;
      const wordCount = content.trim() ? content.trim().split(/\s+/).length : 0;
      const charCount = content.length;
      
      document.getElementById('word-count').textContent = `${wordCount} words`;
      document.getElementById('char-count').textContent = `${charCount} characters`;
    }
    
    function copyContent() {
      const content = document.getElementById('content-editor').value;
      if (!content.trim()) {
        alert('No content to copy!');
        return;
      }
      
      navigator.clipboard.writeText(content).then(() => {
        alert('Content copied to clipboard!');
      }).catch(() => {
        alert('Failed to copy content. Please try again.');
      });
    }
    
    function downloadContent() {
      const content = document.getElementById('content-editor').value;
      if (!content.trim()) {
        alert('No content to download!');
        return;
      }
      
      const blob = new Blob([content], { type: 'text/plain' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `ai-generated-content-${new Date().toISOString().slice(0, 10)}.txt`;
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
    }
    
    // Canvas message action functions
    function previewCanvas(canvasId) {
      const canvas = document.getElementById(canvasId);
      const content = canvas.querySelector('.canvas-content').innerHTML;
      
      const previewWindow = window.open('', '_blank', 'width=800,height=600');
      previewWindow.document.write(`
        <!DOCTYPE html>
        <html>
        <head>
          <title>Content Preview</title>
          <style>
            body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; padding: 20px; line-height: 1.6; }
            h1, h2, h3 { color: #333; }
            p { margin-bottom: 1em; }
            ul { margin: 1em 0; }
            li { margin-bottom: 0.5em; }
          </style>
        </head>
        <body>
          ${content}
        </body>
        </html>
      `);
      previewWindow.document.close();
    }
    
    function editCanvas(canvasId) {
      const canvas = document.getElementById(canvasId);
      const contentDiv = canvas.querySelector('.canvas-content');
      const currentContent = contentDiv.textContent || contentDiv.innerText;
      
      const editModal = document.createElement('div');
      editModal.className = 'modal';
      editModal.style.display = 'flex';
      editModal.innerHTML = `
        <div class="modal-content" style="max-width: 800px; width: 90%;">
          <div class="modal-header">
            <h3>Edit Content</h3>
            <span class="close" onclick="this.closest('.modal').remove()">×</span>
          </div>
          <div class="modal-body">
            <textarea id="edit-textarea" style="width: 100%; height: 400px; padding: 10px; border: 1px solid #ddd; border-radius: 4px; font-family: inherit; resize: vertical;">${currentContent}</textarea>
          </div>
          <div class="modal-footer">
            <button onclick="saveCanvasEdit('${canvasId}', this)" class="btn btn-primary">Save Changes</button>
            <button onclick="this.closest('.modal').remove()" class="btn btn-secondary">Cancel</button>
          </div>
        </div>
      `;
      
      document.body.appendChild(editModal);
      document.getElementById('edit-textarea').focus();
    }
    
    function saveCanvasEdit(canvasId, button) {
      const textarea = document.getElementById('edit-textarea');
      const newContent = textarea.value;
      const canvas = document.getElementById(canvasId);
      const contentDiv = canvas.querySelector('.canvas-content');
      
      contentDiv.innerHTML = formatContent(newContent);
      
      // Update stats
      const statsDiv = canvas.querySelector('.canvas-stats');
      const wordCount = newContent.trim() ? newContent.trim().split(/\s+/).length : 0;
      const charCount = newContent.length;
      const timestamp = new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
      
      statsDiv.innerHTML = `
        <span>${wordCount} words</span>
        <span>${charCount} characters</span>
        <span>Edited at ${timestamp}</span>
      `;
      
      button.closest('.modal').remove();
    }
    
    function copyCanvas(canvasId) {
      const canvas = document.getElementById(canvasId);
      const content = canvas.querySelector('.canvas-content').textContent || canvas.querySelector('.canvas-content').innerText;
      
      navigator.clipboard.writeText(content).then(() => {
        showNotification('Content copied to clipboard!', 'success');
      }).catch(() => {
        // Fallback for older browsers
        const textArea = document.createElement('textarea');
        textArea.value = content;
        document.body.appendChild(textArea);
        textArea.select();
        document.execCommand('copy');
        document.body.removeChild(textArea);
        showNotification('Content copied to clipboard!', 'success');
      });
    }
    
    function addCitations(canvasId) {
      const canvas = document.getElementById(canvasId);
      const contentDiv = canvas.querySelector('.canvas-content');
      
      const citationModal = document.createElement('div');
      citationModal.className = 'modal';
      citationModal.style.display = 'flex';
      citationModal.innerHTML = `
        <div class="modal-content" style="max-width: 600px;">
          <div class="modal-header">
            <h3>Add Citations</h3>
            <span class="close" onclick="this.closest('.modal').remove()">×</span>
          </div>
          <div class="modal-body">
            <div style="margin-bottom: 15px;">
              <label>Citation Text:</label>
              <input type="text" id="citation-text" placeholder="Enter citation text" style="width: 100%; padding: 8px; margin-top: 5px; border: 1px solid #ddd; border-radius: 4px;" />
            </div>
            <div style="margin-bottom: 15px;">
              <label>Source URL (optional):</label>
              <input type="url" id="citation-url" placeholder="https://example.com" style="width: 100%; padding: 8px; margin-top: 5px; border: 1px solid #ddd; border-radius: 4px;" />
            </div>
          </div>
          <div class="modal-footer">
            <button onclick="insertCitation('${canvasId}', this)" class="btn btn-primary">Add Citation</button>
            <button onclick="this.closest('.modal').remove()" class="btn btn-secondary">Cancel</button>
          </div>
        </div>
      `;
      
      document.body.appendChild(citationModal);
      document.getElementById('citation-text').focus();
    }
    
    function insertCitation(canvasId, button) {
      const citationText = document.getElementById('citation-text').value;
      const citationUrl = document.getElementById('citation-url').value;
      
      if (!citationText.trim()) {
        showNotification('Please enter citation text', 'error');
        return;
      }
      
      const canvas = document.getElementById(canvasId);
      const contentDiv = canvas.querySelector('.canvas-content');
      
      const citation = citationUrl ? 
        `<sup><a href="${citationUrl}" target="_blank" style="color: #007bff; text-decoration: none;">[${citationText}]</a></sup>` :
        `<sup>[${citationText}]</sup>`;
      
      contentDiv.innerHTML += citation;
      
      button.closest('.modal').remove();
      showNotification('Citation added successfully!', 'success');
    }
    
    function downloadCanvas(canvasId) {
      const canvas = document.getElementById(canvasId);
      const title = canvas.querySelector('.canvas-title').textContent.replace(/^.*\s/, '').trim();
      const content = canvas.querySelector('.canvas-content').textContent || canvas.querySelector('.canvas-content').innerText;
      
      const blob = new Blob([content], { type: 'text/plain' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `${title.replace(/[^a-z0-9]/gi, '_').toLowerCase()}.txt`;
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
      
      showNotification('Content downloaded successfully!', 'success');
    }
    
    function showNotification(message, type = 'info') {
      const notification = document.createElement('div');
      notification.style.cssText = `
        position: fixed;
        top: 20px;
        right: 20px;
        padding: 12px 20px;
        border-radius: 4px;
        color: white;
        font-weight: 500;
        z-index: 10000;
        animation: slideIn 0.3s ease;
      `;
      
      switch(type) {
        case 'success':
          notification.style.backgroundColor = '#28a745';
          break;
        case 'error':
          notification.style.backgroundColor = '#dc3545';
          break;
        default:
          notification.style.backgroundColor = '#007bff';
      }
      
      notification.textContent = message;
      document.body.appendChild(notification);
      
      setTimeout(() => {
        notification.style.animation = 'slideOut 0.3s ease';
        setTimeout(() => notification.remove(), 300);
      }, 3000);
    }
    
    function clearEditor() {
      if (confirm('Are you sure you want to clear the editor? This action cannot be undone.')) {
        document.getElementById('content-editor').value = '';
        updateContentStats();
      }
    }
    
    function previewContent() {
      const content = document.getElementById('content-editor').value;
      if (!content.trim()) {
        alert('No content to preview!');
        return;
      }
      
      // Create preview window
      const previewWindow = window.open('', '_blank', 'width=800,height=600');
      previewWindow.document.write(`
        <html>
          <head>
            <title>Content Preview</title>
            <style>
              body { font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; line-height: 1.6; }
              h1, h2, h3 { color: #333; }
              pre { background: #f5f5f5; padding: 10px; border-radius: 5px; }
            </style>
          </head>
          <body>
            <pre>${content.replace(/</g, '&lt;').replace(/>/g, '&gt;')}</pre>
          </body>
        </html>
      `);
      previewWindow.document.close();
    }
    
    function editContent() {
      const editor = document.getElementById('content-editor');
      editor.focus();
      editor.setSelectionRange(editor.value.length, editor.value.length);
    }
    
    function openHistoryModal() {
      const historyModal = document.getElementById('history-modal');
      historyModal.style.display = 'flex';
      loadProjectHistory();
    }
    
    function loadProjectHistory() {
      // Load user's actual project history from backend
      const historyGrid = document.getElementById('history-grid');
      
      // Show loading state
      historyGrid.innerHTML = '<div class="loading-state"><i class="fas fa-spinner fa-spin"></i> Loading your projects...</div>';
      
      // TODO: Replace with actual API call to fetch user's content history
      // For now, show empty state
      setTimeout(() => {
        historyGrid.innerHTML = '<div class="empty-state"><i class="fas fa-folder-open"></i><p>No projects yet. Start writing to see your history here!</p></div>';
      }, 1000);
    }
    
    function loadHistoryItem(itemId) {
      // TODO: Load specific history item from backend
      console.log(`Loading project: ${itemId}`);
    }
    
    function loadToEditor(itemId) {
      // TODO: Load actual content from backend API
      // For now, show message that this feature requires backend connection
      alert('This feature requires backend connection. Please ensure the server is running.');
      
      // Close modal
      document.getElementById('history-modal').style.display = 'none';
      
      alert('Content loaded to editor!');
    }
    
    // Premium quality tier is now available to all users at 2x credit cost
    // No plan restrictions needed - credit system handles access control
    
    function toggleQualityOptions() {
      const dropdown = document.getElementById('quality-options');
      const isVisible = dropdown.style.display !== 'none';
      dropdown.style.display = isVisible ? 'none' : 'block';
    }
    
    // Close quality dropdown when clicking outside
    document.addEventListener('click', function(event) {
      const dropdown = document.getElementById('quality-options');
      const filterBtn = document.querySelector('.quality-filter-btn');
      
      if (!dropdown.contains(event.target) && !filterBtn.contains(event.target)) {
        dropdown.style.display = 'none';
      }
    });
  </script>


</body>
</html>
